import boto3
from botocore.config import Config

# Configurations
SOURCE_BUCKET = 'source-bucket-name'
TARGET_BUCKET = 'target-bucket-name'
SOURCE_ENDPOINT = 'https://source-endpoint'
TARGET_ENDPOINT = 'https://target-endpoint'

# Source credentials
source_session = boto3.session.Session(
    aws_access_key_id='SOURCE_ACCESS_KEY',
    aws_secret_access_key='SOURCE_SECRET_KEY'
)
source_s3 = source_session.client('s3', endpoint_url=SOURCE_ENDPOINT, config=Config(signature_version='s3v4'))

# Target credentials
target_session = boto3.session.Session(
    aws_access_key_id='TARGET_ACCESS_KEY',
    aws_secret_access_key='TARGET_SECRET_KEY'
)
target_s3 = target_session.client('s3', endpoint_url=TARGET_ENDPOINT, config=Config(signature_version='s3v4'))

# Copy a single object (for test)
def copy_one_object():
    response = source_s3.list_objects_v2(Bucket=SOURCE_BUCKET, MaxKeys=1)
    objects = response.get('Contents', [])
    if not objects:
        print("No objects found in the source bucket.")
        return

    key = objects[0]['Key']
    print(f"Copying single object for test: {key}")

    try:
        source_obj = source_s3.get_object(Bucket=SOURCE_BUCKET, Key=key)
        target_s3.upload_fileobj(source_obj['Body'], TARGET_BUCKET, key)
        print(f"Successfully copied '{key}' to target bucket.")
    except Exception as e:
        print(f"Error copying '{key}': {str(e)}")

copy_one_object()
