- name: Write registered variable and another variable to separate columns in a CSV file
  hosts: localhost
  tasks:
    - name: Run a command to get some output (example task)
      command: echo "value_from_command"
      register: X

    - name: Define another variable
      set_fact:
        var2: "value2"

    - name: Write data to CSV file using template
      template:
        src: data.csv.j2
        dest: /path/to/yourfile.csv
        mode: '0644'
      vars:
        var1: "{{ X.stdout }}"
        var2: "{{ var2 }}"

apiVersion: v1
kind: ConfigMap
metadata:
  name: cluster-urls-config
data:
  CENTRAL_SERVER_URL: "https://api.central.openshift.example.com:6443"
  EAST_SERVER_URL: "https://api.east.openshift.example.com:6443"

oc apply -f cluster-urls-config.yaml

apiVersion: v1
kind: Secret
metadata:
  name: cluster-tokens-secret
type: Opaque
data:
  CENTRAL_TOKEN: $(echo -n "your-central-token" | base64)
  EAST_TOKEN: $(echo -n "your-east-token" | base64)

oc apply -f cluster-tokens-secret.yaml

apiVersion: v1
kind: Template
metadata:
  name: crd-comparator-app
objects:
  - apiVersion: apps/v1
    kind: Deployment
    metadata:
      name: go-backend
    spec:
      replicas: 1
      selector:
        matchLabels:
          app: go-backend
      template:
        metadata:
          labels:
            app: go-backend
        spec:
          containers:
            - name: go-backend
              image: $(REGISTRY_URL)/$(PROJECT)/go-backend:latest
              ports:
                - containerPort: 8080
              env:
                - name: CENTRAL_SERVER_URL
                  valueFrom:
                    configMapKeyRef:
                      name: cluster-urls-config
                      key: CENTRAL_SERVER_URL
                - name: EAST_SERVER_URL
                  valueFrom:
                    configMapKeyRef:
                      name: cluster-urls-config
                      key: EAST_SERVER_URL
                - name: CENTRAL_TOKEN
                  valueFrom:
                    secretKeyRef:
                      name: cluster-tokens-secret
                      key: CENTRAL_TOKEN
                - name: EAST_TOKEN
                  valueFrom:
                    secretKeyRef:
                      name: cluster-tokens-secret
                      key: EAST_TOKEN
  - apiVersion: v1
    kind: Service
    metadata:
      name: go-backend
    spec:
      ports:
        - port: 8080
          targetPort: 8080
      selector:
        app: go-backend
  - apiVersion: route.openshift.io/v1
    kind: Route
    metadata:
      name: go-backend
    spec:
      to:
        kind: Service
        name: go-backend
      port:
        targetPort: 8080
  - apiVersion: apps/v1
    kind: Deployment
    metadata:
      name: react-frontend
    spec:
      replicas: 1
      selector:
        matchLabels:
          app: react-frontend
      template:
        metadata:
          labels:
            app: react-frontend
        spec:
          containers:
            - name: react-frontend
              image: $(REGISTRY_URL)/$(PROJECT)/react-frontend:latest
              ports:
                - containerPort: 80
  - apiVersion: v1
    kind: Service
    metadata:
      name: react-frontend
    spec:
      ports:
        - port: 80
          targetPort: 80
      selector:
        app: react-frontend
  - apiVersion: route.openshift.io/v1
    kind: Route
    metadata:
      name: react-frontend
    spec:
      to:
        kind: Service
        name: react-frontend
      port:
        targetPort: 80
