# Start OC CLI container interactively
podman run -it --name oc-cli-container registry.redhat.io/ubi8/ubi:latest /bin/bash

# Inside the container, run these commands:
# Update system and install dependencies
dnf update -y && dnf install -y wget curl tar gzip

# Install govc
GOVC_VERSION=v0.33.0
wget -O /tmp/govc_Linux_x86_64.tar.gz \
  "https://github.com/vmware/govmomi/releases/download/${GOVC_VERSION}/govc_Linux_x86_64.tar.gz"
tar -xzf /tmp/govc_Linux_x86_64.tar.gz -C /usr/local/bin/
chmod +x /usr/local/bin/govc
rm /tmp/govc_Linux_x86_64.tar.gz

# Verify govc installation
govc version

# Exit the container
exit

# Commit the container to create new image
podman commit oc-cli-container oc-cli-govc:latest

# Tag for internal registry (update with your registry URL)
podman tag oc-cli-govc:latest your-registry.com:5000/namespace/oc-cli-govc:latest

# Login to internal registry
podman login your-registry.com:5000

# Push to internal registry
podman push your-registry.com:5000/namespace/oc-cli-govc:latest

# Clean up local container
podman rm oc-cli-container

# Test the final image
podman run -it --rm your-registry.com:5000/namespace/oc-cli-govc:latest /bin/bash -c "oc version --client && govc version"


- name: Set up GitHub CLI
  run: |
    # Check if GitHub CLI is available
    if ! command -v gh &> /dev/null; then
      echo "Installing GitHub CLI..."
      
      # Get system architecture
      ARCH=$(uname -m)
      case $ARCH in
        x86_64) ARCH="amd64" ;;
        aarch64) ARCH="arm64" ;;
        arm64) ARCH="arm64" ;;
      esac
      
      # Get latest version
      LATEST_VERSION=$(curl -s https://api.github.com/repos/cli/cli/releases/latest | grep -o '"tag_name": "[^"]*' | grep -o '[^"]*$' | sed 's/v//')
      
      # Download and install
      curl -fsSL "https://github.com/cli/cli/releases/latest/download/gh_${LATEST_VERSION}_linux_${ARCH}.tar.gz" -o gh.tar.gz
      tar -xzf gh.tar.gz
      sudo mv gh_${LATEST_VERSION}_linux_${ARCH}/bin/gh /usr/local/bin/
      sudo chmod +x /usr/local/bin/gh
      rm -rf gh_${LATEST_VERSION}_linux_${ARCH} gh.tar.gz
    else
      echo "GitHub CLI already installed"
    fi
    
    # Verify installation
    gh --version
    
    # Authenticate using token with GitHub Enterprise hostname
    # Replace 'your-github-enterprise-hostname.com' with your actual GitHub Enterprise hostname
    echo "${{ secrets.GH_FUNC_TOKEN }}" | gh auth login --hostname your-github-enterprise-hostname.com --with-token
  env:
    GH_HOST: your-github-enterprise-hostname.com






- name: Set up GitHub CLI
  run: |
    # Check if GitHub CLI is available
    if ! command -v gh &> /dev/null; then
      echo "Installing GitHub CLI..."
      
      # Get system architecture
      ARCH=$(uname -m)
      case $ARCH in
        x86_64) ARCH="amd64" ;;
        aarch64) ARCH="arm64" ;;
        arm64) ARCH="arm64" ;;
      esac
      
      # Get latest version
      LATEST_VERSION=$(curl -s https://api.github.com/repos/cli/cli/releases/latest | grep -o '"tag_name": "[^"]*' | grep -o '[^"]*$' | sed 's/v//')
      
      # Download and install
      curl -fsSL "https://github.com/cli/cli/releases/latest/download/gh_${LATEST_VERSION}_linux_${ARCH}.tar.gz" -o gh.tar.gz
      tar -xzf gh.tar.gz
      sudo mv gh_${LATEST_VERSION}_linux_${ARCH}/bin/gh /usr/local/bin/
      sudo chmod +x /usr/local/bin/gh
      rm -rf gh_${LATEST_VERSION}_linux_${ARCH} gh.tar.gz
    else
      echo "GitHub CLI already installed"
    fi
    
    # Verify installation
    gh --version
    
    # Authenticate using token
    echo "${{ secrets.GH_FUNC_TOKEN }}" | gh auth login --with-token



- name: Set up GitHub CLI
  run: |
    # Check if GitHub CLI is available and install/update if needed
    if ! command -v gh &> /dev/null; then
      echo "Installing GitHub CLI..."
      # Create the keyrings directory if it doesn't exist
      sudo mkdir -p /usr/share/keyrings
      # Download and add the GitHub CLI GPG key
      curl -fsSL https://cli.github.com/packages/githubcli-archive-keyring.gpg | sudo dd of=/usr/share/keyrings/githubcli-archive-keyring.gpg
      # Set proper permissions
      sudo chmod go+r /usr/share/keyrings/githubcli-archive-keyring.gpg
      # Add the GitHub CLI repository
      echo "deb [arch=$(dpkg --print-architecture) signed-by=/usr/share/keyrings/githubcli-archive-keyring.gpg] https://cli.github.com/packages stable main" | sudo tee /etc/apt/sources.list.d/github-cli.list > /dev/null
      # Update package list and install
      sudo apt update
      sudo apt install gh -y
    fi
    
    # Verify installation and check version
    gh --version
    
    # Authenticate using token
    echo "${{ secrets.GH_FUNC_TOKEN }}" | gh auth login --with-token
