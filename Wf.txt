- name: Set up GitHub CLI
  run: |
    # Check if GitHub CLI is available and install/update if needed
    if ! command -v gh &> /dev/null; then
      echo "Installing GitHub CLI..."
      # Create the keyrings directory if it doesn't exist
      sudo mkdir -p /usr/share/keyrings
      # Download and add the GitHub CLI GPG key
      curl -fsSL https://cli.github.com/packages/githubcli-archive-keyring.gpg | sudo dd of=/usr/share/keyrings/githubcli-archive-keyring.gpg
      # Set proper permissions
      sudo chmod go+r /usr/share/keyrings/githubcli-archive-keyring.gpg
      # Add the GitHub CLI repository
      echo "deb [arch=$(dpkg --print-architecture) signed-by=/usr/share/keyrings/githubcli-archive-keyring.gpg] https://cli.github.com/packages stable main" | sudo tee /etc/apt/sources.list.d/github-cli.list > /dev/null
      # Update package list and install
      sudo apt update
      sudo apt install gh -y
    fi
    
    # Verify installation and check version
    gh --version
    
    # Authenticate using token
    echo "${{ secrets.GH_FUNC_TOKEN }}" | gh auth login --with-token
