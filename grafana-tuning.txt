max(
  (
    container_memory_working_set_bytes{pod=~"etcd-.*|kube-apiserver-.*", container!="", container!="POD"}
    /
    on(pod, container)
    container_spec_memory_limit_bytes{pod=~"etcd-.*|kube-apiserver-.*", container!="", container!="POD", container_spec_memory_limit_bytes > 0}
  ) * 100
)

------------------------------------
max by(pod) (
  (
    container_memory_working_set_bytes{pod=~"etcd-.*|kube-apiserver-.*", container!="", container!="POD"}
    /
    on(pod, container)
    container_spec_memory_limit_bytes{pod=~"etcd-.*|kube-apiserver-.*", container!="", container!="POD"}
  ) * 100
)

The priority matrix for the recommendations was reviewed, with encryption being a high priority. The next steps involve deploying monitoring to identify affected clusters, document current resource utilization patterns, and implement tunings. Additionally, there is a need for a centralized alert system, correlation of activities to metrics, and a framework for AIOps exercises.

To receive some alert. Of course, there will be a protocol alert, but I am pretty sure there can be warnings to us. And of course, those are pretty defined.

And for these custom alerts, they are sometimes warning, sometimes even informational. And you know, if we have a place to store them on a centralized, that would be powerful for lower, I think. It is not a KP, it is not just part of this recommendation, but I think that is something else. We could look at, so can I get Chris.. Yes, sure yes.

Yes. You? Yes, yes, it makes sense. It looks to me like a good approach to a good solution to our future events.


	•	Custom Alerts Storage: Proposal to centralize storage for custom alerts, which can be informational or warning-type, separate from protocol alerts.
	•	Future Events Solution: Agreement on a good approach to address future events, with Alex taking the lead on exploring it.
	•	Criticality of Prioritized Items: Discussion on the criticality of prioritized items, particularly encryption, and whether existing measures like SCD are sufficient.
	•	Encryption and Memory Management: Discussion about the use of encryption in back-end commits, its impact on CPU memory, and the need for encryption key rotation.
	•	Correlating Events and Activities: The need to find a way to correlate events, such as instance failures, with specific activities like API updates or key rotations.
	•	Performance and Stability Improvements: Mentioning the use of Sat nodes, limits, and suspensions to improve efficiency, handle speed times, and enhance stability.
	•	Next Steps for Deployment Monitoring: Identify affected clusters, document current resource utilization patterns, and implement tunings.
	•	Analyzing Resource Utilization: Analyze dashboard data to identify patterns, issues, and important areas for action.
	•	Alerting and Tuning Strategy: Avoid unnecessary alerts and focus on actionable insights. Prioritize identifying problems and solutions before implementing tunings.
	•	Focus of Analysis: Prioritize infrastructure analysis over control plane, considering accountability and potential impacts.
	•	Documentation and Monitoring: Ongoing documentation and analysis of issues per cluster, including impact assessment and validation.
	•	Next Steps: Transition from data collection to identifying potential issues and creating mitigation strategies.
	•	Data Monitoring and Analysis: Monitoring environmental and tax issues, potentially through AIO exercises, and correlating data for insights.
	•	Data Storage and Signatures: Storing relevant events, product metrics (FCD, PPI), and alerts, and correlating them for analysis.
	•	Potential Tools and Technologies: Exploring tools like Ketder and considering the scalability of options like JBM and HPA.
	•	Next Steps Confirmation: Agreement on the next steps to be taken.
	•	Meeting Summary: A 10-minute meeting that was considered productive.
	•	Post-Meeting Discussion: An invitation for further discussion after the meeting concludes.



Summary:

The discussion focused on improving alert protocols, prioritizing monitoring systems, and refining resource utilization analysis. Key topics included the necessity for custom alerts, encryption-related monitoring, correlation of events with activities, resource efficiency improvements, and the development of a comprehensive framework for event tracking and analysis. The team emphasized the importance of meaningful alerts, accurate correlation of activities, and systematic monitoring to preempt potential issues.

Action Items and Next Steps:
Custom Alert Development:
Next Steps: Define parameters for custom alerts, differentiate between warning and informational types, and centralize storage for better accessibility.
Encryption Monitoring:
Next Steps: Review existing systems (e.g., back-end commits) for encryption-related activities, assess CPU/memory impacts, and ensure proper monitoring is in place.
Event Correlation Framework:
Next Steps: Develop methods to correlate activities with specific incidents, focusing on key rotations, API updates, and system anomalies.
Dashboard Analysis:
Next Steps: Utilize the dashboard to identify patterns and resource utilization issues, document findings, and determine critical impacts.
Monitoring and Resource Analysis:
Next Steps:
Phase 1: Deploy monitoring tools, identify affected clusters, and document current resource usage.
Phase 2: Implement tuning based on Phase 1 data.
Phase 3: Analyze identified issues and develop solutions.
Alert Optimization:
Next Steps: Refine alert criteria to avoid unnecessary notifications, ensuring alerts are actionable and relevant.
Framework for Event and Alert Correlation:
Next Steps: Design a framework to correlate metrics data with events, enhancing visibility and response strategies.
JVM and HPA Monitoring:
Next Steps: Assess the necessity and priority of JVM and HPA-related monitoring, focusing on scalability and impact.
Continuous Documentation and Review:
Next Steps: Ongoing documentation of analysis, impact assessments, and validation of recurring issues.
Periodic Discussions and Updates:
Next Steps: Regular check-ins to review progress, discuss findings, and adjust strategies as needed.


	•	The next step is to identify issues in the clusters.
	•	The first phase is to deploy monitoring and identify affected clusters.
	•	The second phase is to implement tunings and deploy them in phase one.
	•	The last step is to document current resource utilization patterns.
	•	The analysis of the numbers in the dashboard is important to identify issues.
	•	The alerts should not be sent just for the sake of it.
	•	The focus should be on identifying important issues that need action.
	•	The tuning phase (phase 3) will come after identifying all the problems and their solutions.
	•	The context is a discussion about analyzing and documenting issues in a system.
	•	The focus is on infrastructure first, not the control plane.
	•	The speaker wants to identify contributors to issues and determine what actions can be taken.
	•	The speaker mentions that they will continue to review documentation and monitor the system for issues.
	•	The speaker mentions that they will create stories to track ongoing issues.
	•	The speaker mentions that they will analyze the status of the system and take appropriate actions.
	•	The speaker mentions that they will identify potential issues or critical components in the system.
	•	The procedure for monitoring the environment and tax issues is not clear.
	•	The band and alert system should be essentialized.
	•	The AIOs exercises should include the implementation of the framework.
	•	The events should be correlated by instant and other means.
	•	The matrics data and signature data should be collected and correlated.
	•	The Ketder and other HPA should be considered.
	•	The JBM might not be considered as it is usually used by one person and is not scalable.
	•	The next steps are being discussed.
-------------------------------------
{
  "datasource": {
    "type": "prometheus",
    "uid": "${datasource}"
  },
  "fieldConfig": {
    "defaults": {
      "unit": "percent",
      "decimals": 1,
      "min": 0,
      "max": 100,
      "thresholds": {
        "mode": "absolute",
        "steps": [
          {
            "color": "green",
            "value": null
          },
          {
            "color": "yellow",
            "value": 70
          },
          {
            "color": "red",
            "value": 85
          }
        ]
      },
      "mappings": []
    },
    "overrides": []
  },
  "gridPos": {
    "h": 7,
    "w": 6,
    "x": 8,
    "y": 12
  },
  "id": 11,
  "options": {
    "colorMode": "value",
    "graphMode": "area",
    "justifyMode": "auto",
    "orientation": "auto",
    "reduceOptions": {
      "values": false,
      "calcs": [
        "lastNotNull"
      ],
      "fields": ""
    },
    "textMode": "auto"
  },
  "pluginVersion": "10.4.0",
  "targets": [
    {
      "datasource": {
        "type": "prometheus",
        "uid": "${datasource}"
      },
      "expr": "max(\n  (\n    container_memory_working_set_bytes{pod=~\"etcd-.*|kube-apiserver-.*\"}\n    /\n    container_spec_memory_limit_bytes{pod=~\"etcd-.*|kube-apiserver-.*\"}\n  ) * 100\n)",
      "instant": true,
      "legendFormat": "Max Memory Usage",
      "refId": "A"
    }
  ],
  "title": "Control Plane Memory Pressure (%)",
  "type": "stat",
  "description": "Maximum memory usage percentage across all control plane components (etcd and kube-apiserver). Values above 85% indicate potential tuning needed."
}
=================
{
  "datasource": { "type": "prometheus", "uid": "${datasource}" },
  "fieldConfig": {
    "defaults": {
      "unit": "percent",
      "decimals": 1,
      "thresholds": {
        "mode": "absolute",
        "steps": [
          { "color": "green", "value": null },
          { "color": "red", "value": 85 }
        ]
      }
    }
  },
  "gridPos": { "h": 7, "w": 6, "x": 8, "y": 12 },
  "id": 11,
  "options": {
    "colorMode": "value",
    "graphMode": "none",
    "justifyMode": "auto",
    "textMode": "auto"
  },
  "pluginVersion": "10.4.0",
  "targets": [
    {
      "datasource": { "type": "prometheus", "uid": "${datasource}" },
      "expr": "max by(pod) (container_memory_working_set_bytes{pod=~\"etcd-.*|kube-apiserver-.*\"} / ignoring(container,resource) group_left kube_pod_container_resource_limits{pod=~\"etcd-.*|kube-apiserver-.*\", resource=\"memory\"}) * 100",
      "instant": true,
      "refId": "A"
    }
  ],
  "title": "Control Plane Memory Pressure (%)",
  "type": "stat"
}



{
  "datasource": { "type": "prometheus", "uid": "${datasource}" },
  "gridPos": { "h": 7, "w": 10, "x": 0, "y": 19 },
  "id": 14,
  "options": {
    "showHeader": true,
    "sortBy": [ { "desc": true, "displayName": "Usage (GiB)" } ]
  },
  "pluginVersion": "10.4.0",
  "targets": [
    {
      "datasource": { "type": "prometheus", "uid": "${datasource}" },
      "expr": "container_memory_working_set_bytes{pod=~\"etcd-.*|kube-apiserver-.*\"} / 1024 / 1024 / 1024",
      "format": "table",
      "instant": true,
      "legendFormat": "Usage",
      "refId": "A"
    },
    {
      "datasource": { "type": "prometheus", "uid": "${datasource}" },
      "expr": "kube_pod_container_resource_limits{pod=~\"etcd-.*|kube-apiserver-.*\", resource=\"memory\"} / 1024 / 1024 / 1024",
      "format": "table",
      "instant": true,
      "legendFormat": "Limit",
      "refId": "B"
    }
  ],
  "title": "Control Plane Memory Details (GiB)",
  "type": "table",
  "transformations": [
    {
      "id": "merge",
      "options": {}
    },
    {
      "id": "organize",
      "options": {
        "excludeByName": {
          "Time": true,
          "container": true,
          "endpoint": true,
          "instance": true,
          "job": true,
          "namespace": true,
          "node": true,
          "resource": true,
          "service": true
        },
        "renameByName": {
          "Value #A": "Usage (GiB)",
          "Value #B": "Limit (GiB)",
          "pod": "Pod"
        }
      }
    },
    {
      "id": "calculateField",
      "options": {
        "alias": "Usage %",
        "binary": {
          "left": "Usage (GiB)",
          "operator": "/",
          "reducer": "sum",
          "right": "Limit (GiB)"
        },
        "mode": "binary",
        "reduce": { "reducer": "sum" },
        "replaceFields": false
      }
    },
    {
      "id": "filterFieldsByName",
      "options": {
        "include": {
          "names": ["Pod", "Usage (GiB)", "Limit (GiB)", "Usage %"]
        }
      }
    }
  ]
}
=========
{
  "annotations": {
    "list": []
  },
  "editable": true,
  "gnetId": null,
  "graphTooltip": 0,
  "id": null,
  "links": [],
  "panels": [
    {
      "datasource": {
        "type": "prometheus",
        "uid": "${datasource}"
      },
      "fieldConfig": {
        "defaults": {
          "mappings": [
            {
              "options": {
                "0": {
                  "text": "OK"
                },
                "1": {
                  "text": "IMPACTED"
                }
              },
              "type": "value"
            }
          ],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": null
              },
              {
                "color": "red",
                "value": 1
              }
            ]
          }
        },
        "overrides": []
      },
      "gridPos": {
        "h": 6,
        "w": 5,
        "x": 0,
        "y": 0
      },
      "id": 1,
      "options": {
        "colorMode": "value",
        "graphMode": "none",
        "justifyMode": "center",
        "textMode": "auto"
      },
      "pluginVersion": "10.4.0",
      "targets": [
        {
          "datasource": {
            "type": "prometheus",
            "uid": "${datasource}"
          },
          "expr": "((container_memory_working_set_bytes{container=~\".*java.*|.*jvm.*\"} / container_spec_memory_limit_bytes{container=~\".*java.*|.*jvm.*\"}) > 0.9) or (rate(kube_pod_container_status_terminated_reason{reason=\"OOMKilled\"}[1h]) > 0 and on(pod) container_memory_working_set_bytes{container=~\".*java.*\"} > 0)",
          "instant": true,
          "refId": "A"
        }
      ],
      "title": "Java Memory Sizing",
      "type": "stat"
    },
    {
      "datasource": {
        "type": "prometheus",
        "uid": "${datasource}"
      },
      "fieldConfig": {
        "defaults": {
          "mappings": [
            {
              "options": {
                "0": {
                  "text": "OK"
                },
                "1": {
                  "text": "IMPACTED"
                }
              },
              "type": "value"
            }
          ],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": null
              },
              {
                "color": "red",
                "value": 1
              }
            ]
          }
        },
        "overrides": []
      },
      "gridPos": {
        "h": 6,
        "w": 5,
        "x": 5,
        "y": 0
      },
      "id": 2,
      "options": {
        "colorMode": "value",
        "graphMode": "none",
        "justifyMode": "center",
        "textMode": "auto"
      },
      "pluginVersion": "10.4.0",
      "targets": [
        {
          "datasource": {
            "type": "prometheus",
            "uid": "${datasource}"
          },
          "expr": "(max by() (container_memory_working_set_bytes{pod=~\"etcd-.*|kube-apiserver-.*\"} / (container_spec_memory_limit_bytes{pod=~\"etcd-.*|kube-apiserver-.*\"} > 0)) >= 0.85) or (max by() (container_memory_working_set_bytes{pod=~\"etcd-.*|kube-apiserver-.*\"}) > 8589934592)",
          "instant": true,
          "refId": "A"
        }
      ],
      "title": "Control Plane Memory",
      "type": "stat"
    },
    {
      "datasource": {
        "type": "prometheus",
        "uid": "${datasource}"
      },
      "fieldConfig": {
        "defaults": {
          "mappings": [
            {
              "options": {
                "0": {
                  "text": "OK"
                },
                "1": {
                  "text": "IMPACTED"
                }
              },
              "type": "value"
            }
          ],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": null
              },
              {
                "color": "red",
                "value": 1
              }
            ]
          }
        },
        "overrides": []
      },
      "gridPos": {
        "h": 6,
        "w": 5,
        "x": 10,
        "y": 0
      },
      "id": 3,
      "options": {
        "colorMode": "value",
        "graphMode": "none",
        "justifyMode": "center",
        "textMode": "auto"
      },
      "pluginVersion": "10.4.0",
      "targets": [
        {
          "datasource": {
            "type": "prometheus",
            "uid": "${datasource}"
          },
          "expr": "histogram_quantile(0.99, rate(etcd_disk_backend_commit_duration_seconds_bucket[5m])) > 0.1",
          "instant": true,
          "refId": "A"
        }
      ],
      "title": "etcd Commit Latency",
      "type": "stat"
    },
    {
      "datasource": {
        "type": "prometheus",
        "uid": "${datasource}"
      },
      "fieldConfig": {
        "defaults": {
          "mappings": [
            {
              "options": {
                "0": {
                  "text": "OK"
                },
                "1": {
                  "text": "IMPACTED"
                }
              },
              "type": "value"
            }
          ],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": null
              },
              {
                "color": "red",
                "value": 1
              }
            ]
          }
        },
        "overrides": []
      },
      "gridPos": {
        "h": 6,
        "w": 5,
        "x": 15,
        "y": 0
      },
      "id": 4,
      "options": {
        "colorMode": "value",
        "graphMode": "none",
        "justifyMode": "center",
        "textMode": "auto"
      },
      "pluginVersion": "10.4.0",
      "targets": [
        {
          "datasource": {
            "type": "prometheus",
            "uid": "${datasource}"
          },
          "expr": "histogram_quantile(0.99, rate(etcd_disk_wal_fsync_duration_seconds_bucket[5m])) > 0.01",
          "instant": true,
          "refId": "A"
        }
      ],
      "title": "etcd WAL Fsync Latency",
      "type": "stat"
    },
    {
      "datasource": {
        "type": "prometheus",
        "uid": "${datasource}"
      },
      "fieldConfig": {
        "defaults": {
          "mappings": [
            {
              "options": {
                "0": {
                  "text": "OK"
                },
                "1": {
                  "text": "IMPACTED"
                }
              },
              "type": "value"
            }
          ],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": null
              },
              {
                "color": "red",
                "value": 1
              }
            ]
          }
        },
        "overrides": []
      },
      "gridPos": {
        "h": 6,
        "w": 4,
        "x": 20,
        "y": 0
      },
      "id": 5,
      "options": {
        "colorMode": "value",
        "graphMode": "none",
        "justifyMode": "center",
        "textMode": "auto"
      },
      "pluginVersion": "10.4.0",
      "targets": [
        {
          "datasource": {
            "type": "prometheus",
            "uid": "${datasource}"
          },
          "expr": "rate(etcd_server_leader_changes_seen_total[10m]) > 0.1",
          "instant": true,
          "refId": "A"
        }
      ],
      "title": "etcd Leader Changes",
      "type": "stat"
    },
    {
      "datasource": {
        "type": "prometheus",
        "uid": "${datasource}"
      },
      "fieldConfig": {
        "defaults": {
          "mappings": [
            {
              "options": {
                "0": {
                  "text": "OK"
                },
                "1": {
                  "text": "IMPACTED"
                }
              },
              "type": "value"
            }
          ],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": null
              },
              {
                "color": "red",
                "value": 1
              }
            ]
          }
        },
        "overrides": []
      },
      "gridPos": {
        "h": 6,
        "w": 5,
        "x": 0,
        "y": 6
      },
      "id": 6,
      "options": {
        "colorMode": "value",
        "graphMode": "none",
        "justifyMode": "center",
        "textMode": "auto"
      },
      "pluginVersion": "10.4.0",
      "targets": [
        {
          "datasource": {
            "type": "prometheus",
            "uid": "${datasource}"
          },
          "expr": "count(count by(node) (kube_pod_info) > 50) > 0",
          "instant": true,
          "refId": "A"
        }
      ],
      "title": "High-Density Nodes",
      "type": "stat"
    },
    {
      "datasource": {
        "type": "prometheus",
        "uid": "${datasource}"
      },
      "fieldConfig": {
        "defaults": {
          "mappings": [
            {
              "options": {
                "0": {
                  "text": "OK"
                },
                "1": {
                  "text": "IMPACTED"
                }
              },
              "type": "value"
            }
          ],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": null
              },
              {
                "color": "red",
                "value": 1
              }
            ]
          }
        },
        "overrides": []
      },
      "gridPos": {
        "h": 6,
        "w": 5,
        "x": 5,
        "y": 6
      },
      "id": 7,
      "options": {
        "colorMode": "value",
        "graphMode": "none",
        "justifyMode": "center",
        "textMode": "auto"
      },
      "pluginVersion": "10.4.0",
      "targets": [
        {
          "datasource": {
            "type": "prometheus",
            "uid": "${datasource}"
          },
          "expr": "(max by() (rate(container_cpu_cfs_throttled_periods_total[5m]) / rate(container_cpu_cfs_periods_total[5m])) or vector(0)) > 0.25",
          "instant": true,
          "refId": "A"
        }
      ],
      "title": "CPU Throttling",
      "type": "stat"
    },
    {
      "datasource": {
        "type": "prometheus",
        "uid": "${datasource}"
      },
      "fieldConfig": {
        "defaults": {
          "mappings": [
            {
              "options": {
                "0": {
                  "text": "OK"
                },
                "1": {
                  "text": "IMPACTED"
                }
              },
              "type": "value"
            }
          ],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": null
              },
              {
                "color": "red",
                "value": 1
              }
            ]
          }
        },
        "overrides": []
      },
      "gridPos": {
        "h": 6,
        "w": 5,
        "x": 10,
        "y": 6
      },
      "id": 8,
      "options": {
        "colorMode": "value",
        "graphMode": "none",
        "justifyMode": "center",
        "textMode": "auto"
      },
      "pluginVersion": "10.4.0",
      "targets": [
        {
          "datasource": {
            "type": "prometheus",
            "uid": "${datasource}"
          },
          "expr": "count(kube_horizontalpodautoscaler_status_condition{condition=\"ScalingLimited\"} == 1) > 0",
          "instant": true,
          "refId": "A"
        }
      ],
      "title": "HPA Scaling Limited",
      "type": "stat"
    },
    {
      "datasource": {
        "type": "prometheus",
        "uid": "${datasource}"
      },
      "fieldConfig": {
        "defaults": {
          "mappings": [
            {
              "options": {
                "0": {
                  "text": "OK"
                },
                "1": {
                  "text": "IMPACTED"
                }
              },
              "type": "value"
            }
          ],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": null
              },
              {
                "color": "red",
                "value": 1
              }
            ]
          }
        },
        "overrides": []
      },
      "gridPos": {
        "h": 6,
        "w": 5,
        "x": 15,
        "y": 6
      },
      "id": 9,
      "options": {
        "colorMode": "value",
        "graphMode": "none",
        "justifyMode": "center",
        "textMode": "auto"
      },
      "pluginVersion": "10.4.0",
      "targets": [
        {
          "datasource": {
            "type": "prometheus",
            "uid": "${datasource}"
          },
          "expr": "count(rate(container_tasks_state{state=\"running\"}[5m]) > 3500 and on(pod) kube_pod_container_status_ready == 1) > 0",
          "instant": true,
          "refId": "A"
        }
      ],
      "title": "Thread/PID Pressure",
      "type": "stat"
    },
    {
      "datasource": {
        "type": "prometheus",
        "uid": "${datasource}"
      },
      "fieldConfig": {
        "defaults": {
          "unit": "gbytes",
          "decimals": 2
        }
      },
      "gridPos": {
        "h": 7,
        "w": 8,
        "x": 0,
        "y": 12
      },
      "id": 10,
      "options": {
        "legend": {
          "displayMode": "list",
          "placement": "bottom"
        },
        "tooltip": {
          "mode": "single"
        }
      },
      "pluginVersion": "10.4.0",
      "targets": [
        {
          "datasource": {
            "type": "prometheus",
            "uid": "${datasource}"
          },
          "expr": "container_memory_working_set_bytes{pod=~\"etcd-.*|kube-apiserver-.*\"} / 1024 / 1024 / 1024",
          "legendFormat": "{{pod}} usage",
          "refId": "A"
        },
        {
          "datasource": {
            "type": "prometheus",
            "uid": "${datasource}"
          },
          "expr": "kube_pod_container_resource_limits{pod=~\"etcd-.*|kube-apiserver-.*\", resource=\"memory\"} / 1024 / 1024 / 1024",
          "legendFormat": "{{pod}} limit",
          "refId": "B"
        }
      ],
      "title": "Control Plane Memory Usage vs Limit (GiB)",
      "type": "timeseries"
    },
    {
      "datasource": {
        "type": "prometheus",
        "uid": "${datasource}"
      },
      "fieldConfig": {
        "defaults": {
          "unit": "percent",
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": null
              },
              {
                "color": "red",
                "value": 85
              }
            ]
          }
        }
      },
      "gridPos": {
        "h": 7,
        "w": 6,
        "x": 8,
        "y": 12
      },
      "id": 11,
      "options": {
        "colorMode": "value",
        "graphMode": "none",
        "justifyMode": "auto",
        "textMode": "auto"
      },
      "pluginVersion": "10.4.0",
      "targets": [
        {
          "datasource": {
            "type": "prometheus",
            "uid": "${datasource}"
          },
          "expr": "max by(pod) (container_memory_working_set_bytes{pod=~\"etcd-.*|kube-apiserver-.*\"} / ignoring(resource) group_left (kube_pod_container_resource_limits{pod=~\"etcd-.*|kube-apiserver-.*\", resource=\"memory\"} > 0)) * 100",
          "instant": true,
          "refId": "A"
        }
      ],
      "title": "Control Plane Memory Pressure (%)",
      "type": "stat"
    },
    {
      "datasource": {
        "type": "prometheus",
        "uid": "${datasource}"
      },
      "fieldConfig": {
        "defaults": {
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": null
              },
              {
                "color": "orange",
                "value": 1
              },
              {
                "color": "red",
                "value": 10
              }
            ]
          }
        }
      },
      "gridPos": {
        "h": 7,
        "w": 4,
        "x": 14,
        "y": 12
      },
      "id": 12,
      "options": {
        "colorMode": "value",
        "graphMode": "none",
        "justifyMode": "center",
        "textMode": "auto"
      },
      "pluginVersion": "10.4.0",
      "targets": [
        {
          "datasource": {
            "type": "prometheus",
            "uid": "${datasource}"
          },
          "expr": "count(kube_horizontalpodautoscaler_status_condition{condition=\"ScalingLimited\"} == 1)",
          "instant": true,
          "refId": "A"
        }
      ],
      "title": "HPAs: ScalingLimited",
      "type": "stat"
    },
    {
      "datasource": {
        "type": "prometheus",
        "uid": "${datasource}"
      },
      "gridPos": {
        "h": 7,
        "w": 6,
        "x": 18,
        "y": 12
      },
      "id": 13,
      "options": {
        "showHeader": true,
        "sortBy": [
          {
            "desc": true,
            "displayName": "Value"
          }
        ]
      },
      "pluginVersion": "10.4.0",
      "targets": [
        {
          "datasource": {
            "type": "prometheus",
            "uid": "${datasource}"
          },
          "expr": "count by(namespace) (kube_horizontalpodautoscaler_status_condition{condition=\"ScalingLimited\"} == 1)",
          "format": "table",
          "instant": true,
          "refId": "A"
        }
      ],
      "title": "Top Namespaces: ScalingLimited HPAs",
      "type": "table"
    }
  ],
  "refresh": "5m",
  "schemaVersion": 39,
  "tags": [
    "openshift",
    "performance",
    "tuning",
    "multi-cluster",
    "enterprise"
  ],
  "templating": {
    "list": [
      {
        "current": {},
        "hide": 0,
        "includeAll": true,
        "label": "Cluster",
        "multi": true,
        "name": "datasource",
        "options": [],
        "query": "prometheus",
        "refresh": 1,
        "regex": "",
        "type": "datasource"
      }
    ]
  },
  "time": {
    "from": "now-1h",
    "to": "now"
  },
  "title": "OpenShift 4.16 Full Tuning Status (v2)",
  "uid": "ocp416-full-tuning-v2",
  "version": 1
}




======================================
(
  max by() (
    container_memory_working_set_bytes{pod=~"etcd-.*|kube-apiserver-.*"}
    / 
    (container_spec_memory_limit_bytes{pod=~"etcd-.*|kube-apiserver-.*"} > 0)
  ) >= 0.85
)
or
(
  max by() (container_memory_working_set_bytes{pod=~"etcd-.*|kube-apiserver-.*"}) > 8589934592
)

count(kube_horizontalpodautoscaler_status_condition{condition="ScalingLimited"} == 1) > 0


========
{
  "annotations": { "list": [] },
  "editable": true,
  "gnetId": null,
  "graphTooltip": 0,
  "id": null,
  "links": [],
  "panels": [
    {
      "datasource": { "type": "prometheus", "uid": "${datasource}" },
      "fieldConfig": {
        "defaults": {
          "mappings": [{ "options": { "0": { "text": "OK" }, "1": { "text": "IMPACTED" } }, "type": "value" }],
          "thresholds": { "mode": "absolute", "steps": [{ "color": "green" }, { "color": "red", "value": 1 }] }
        }
      },
      "gridPos": { "h": 6, "w": 5, "x": 0, "y": 0 },
      "id": 1,
      "options": { "colorMode": "value", "graphMode": "none", "justifyMode": "center", "textMode": "auto" },
      "pluginVersion": "10.4.0",
      "targets": [{
        "datasource": { "type": "prometheus", "uid": "${datasource}" },
        "expr": "((container_memory_working_set_bytes{container=~\".*java.*|.*jvm.*\"} / container_spec_memory_limit_bytes{container=~\".*java.*|.*jvm.*\"}) > 0.9) or (rate(kube_pod_container_status_terminated_reason{reason=\"OOMKilled\"}[1h]) > 0 and on(pod) container_memory_working_set_bytes{container=~\".*java.*\"} > 0)",
        "instant": true,
        "refId": "A"
      }],
      "title": "Java Memory Sizing",
      "type": "stat"
    },
    {
      "datasource": { "type": "prometheus", "uid": "${datasource}" },
      "fieldConfig": {
        "defaults": {
          "mappings": [{ "options": { "0": { "text": "OK" }, "1": { "text": "IMPACTED" } }, "type": "value" }],
          "thresholds": { "mode": "absolute", "steps": [{ "color": "green" }, { "color": "red", "value": 1 }] }
        }
      },
      "gridPos": { "h": 6, "w": 5, "x": 5, "y": 0 },
      "id": 2,
      "options": { "colorMode": "value", "graphMode": "none", "justifyMode": "center", "textMode": "auto" },
      "pluginVersion": "10.4.0",
      "targets": [{
        "datasource": { "type": "prometheus", "uid": "${datasource}" },
        "expr": "(max by() (container_memory_working_set_bytes{pod=~\"etcd-.*|kube-apiserver-.*\"} / container_spec_memory_limit_bytes{pod=~\"etcd-.*|kube-apiserver-.*\"}) or vector(0)) >= 0.85",
        "instant": true,
        "refId": "A"
      }],
      "title": "Control Plane Memory",
      "type": "stat"
    },
    {
      "datasource": { "type": "prometheus", "uid": "${datasource}" },
      "fieldConfig": {
        "defaults": {
          "mappings": [{ "options": { "0": { "text": "OK" }, "1": { "text": "IMPACTED" } }, "type": "value" }],
          "thresholds": { "mode": "absolute", "steps": [{ "color": "green" }, { "color": "red", "value": 1 }] }
        }
      },
      "gridPos": { "h": 6, "w": 5, "x": 10, "y": 0 },
      "id": 3,
      "options": { "colorMode": "value", "graphMode": "none", "justifyMode": "center", "textMode": "auto" },
      "pluginVersion": "10.4.0",
      "targets": [{
        "datasource": { "type": "prometheus", "uid": "${datasource}" },
        "expr": "histogram_quantile(0.99, rate(etcd_disk_backend_commit_duration_seconds_bucket[5m])) > 0.1",
        "instant": true,
        "refId": "A"
      }],
      "title": "etcd Commit Latency",
      "type": "stat"
    },
    {
      "datasource": { "type": "prometheus", "uid": "${datasource}" },
      "fieldConfig": {
        "defaults": {
          "mappings": [{ "options": { "0": { "text": "OK" }, "1": { "text": "IMPACTED" } }, "type": "value" }],
          "thresholds": { "mode": "absolute", "steps": [{ "color": "green" }, { "color": "red", "value": 1 }] }
        }
      },
      "gridPos": { "h": 6, "w": 5, "x": 15, "y": 0 },
      "id": 4,
      "options": { "colorMode": "value", "graphMode": "none", "justifyMode": "center", "textMode": "auto" },
      "pluginVersion": "10.4.0",
      "targets": [{
        "datasource": { "type": "prometheus", "uid": "${datasource}" },
        "expr": "histogram_quantile(0.99, rate(etcd_disk_wal_fsync_duration_seconds_bucket[5m])) > 0.01",
        "instant": true,
        "refId": "A"
      }],
      "title": "etcd WAL Fsync Latency",
      "type": "stat"
    },
    {
      "datasource": { "type": "prometheus", "uid": "${datasource}" },
      "fieldConfig": {
        "defaults": {
          "mappings": [{ "options": { "0": { "text": "OK" }, "1": { "text": "IMPACTED" } }, "type": "value" }],
          "thresholds": { "mode": "absolute", "steps": [{ "color": "green" }, { "color": "red", "value": 1 }] }
        }
      },
      "gridPos": { "h": 6, "w": 4, "x": 20, "y": 0 },
      "id": 5,
      "options": { "colorMode": "value", "graphMode": "none", "justifyMode": "center", "textMode": "auto" },
      "pluginVersion": "10.4.0",
      "targets": [{
        "datasource": { "type": "prometheus", "uid": "${datasource}" },
        "expr": "rate(etcd_server_leader_changes_seen_total[10m]) > 0.1",
        "instant": true,
        "refId": "A"
      }],
      "title": "etcd Leader Changes",
      "type": "stat"
    },
    {
      "datasource": { "type": "prometheus", "uid": "${datasource}" },
      "fieldConfig": {
        "defaults": {
          "mappings": [{ "options": { "0": { "text": "OK" }, "1": { "text": "IMPACTED" } }, "type": "value" }],
          "thresholds": { "mode": "absolute", "steps": [{ "color": "green" }, { "color": "red", "value": 1 }] }
        }
      },
      "gridPos": { "h": 6, "w": 5, "x": 0, "y": 6 },
      "id": 6,
      "options": { "colorMode": "value", "graphMode": "none", "justifyMode": "center", "textMode": "auto" },
      "pluginVersion": "10.4.0",
      "targets": [{
        "datasource": { "type": "prometheus", "uid": "${datasource}" },
        "expr": "count(count by(node) (kube_pod_info) > 50) > 0",
        "instant": true,
        "refId": "A"
      }],
      "title": "High-Density Nodes",
      "type": "stat"
    },
    {
      "datasource": { "type": "prometheus", "uid": "${datasource}" },
      "fieldConfig": {
        "defaults": {
          "mappings": [{ "options": { "0": { "text": "OK" }, "1": { "text": "IMPACTED" } }, "type": "value" }],
          "thresholds": { "mode": "absolute", "steps": [{ "color": "green" }, { "color": "red", "value": 1 }] }
        }
      },
      "gridPos": { "h": 6, "w": 5, "x": 5, "y": 6 },
      "id": 7,
      "options": { "colorMode": "value", "graphMode": "none", "justifyMode": "center", "textMode": "auto" },
      "pluginVersion": "10.4.0",
      "targets": [{
        "datasource": { "type": "prometheus", "uid": "${datasource}" },
        "expr": "(max by() (rate(container_cpu_cfs_throttled_periods_total[5m]) / rate(container_cpu_cfs_periods_total[5m])) or vector(0)) > 0.25",
        "instant": true,
        "refId": "A"
      }],
      "title": "CPU Throttling",
      "type": "stat"
    },
    {
      "datasource": { "type": "prometheus", "uid": "${datasource}" },
      "fieldConfig": {
        "defaults": {
          "mappings": [{ "options": { "0": { "text": "OK" }, "1": { "text": "IMPACTED" } }, "type": "value" }],
          "thresholds": { "mode": "absolute", "steps": [{ "color": "green" }, { "color": "red", "value": 1 }] }
        }
      },
      "gridPos": { "h": 6, "w": 5, "x": 10, "y": 6 },
      "id": 8,
      "options": { "colorMode": "value", "graphMode": "none", "justifyMode": "center", "textMode": "auto" },
      "pluginVersion": "10.4.0",
      "targets": [{
        "datasource": { "type": "prometheus", "uid": "${datasource}" },
        "expr": "count(rate(kube_horizontalpodautoscaler_status_condition{condition=\"ScalingLimited\"}[5m]) > 0) > 0",
        "instant": true,
        "refId": "A"
      }],
      "title": "HPA Scaling Limited",
      "type": "stat"
    },
    {
      "datasource": { "type": "prometheus", "uid": "${datasource}" },
      "fieldConfig": {
        "defaults": {
          "mappings": [{ "options": { "0": { "text": "OK" }, "1": { "text": "IMPACTED" } }, "type": "value" }],
          "thresholds": { "mode": "absolute", "steps": [{ "color": "green" }, { "color": "red", "value": 1 }] }
        }
      },
      "gridPos": { "h": 6, "w": 5, "x": 15, "y": 6 },
      "id": 9,
      "options": { "colorMode": "value", "graphMode": "none", "justifyMode": "center", "textMode": "auto" },
      "pluginVersion": "10.4.0",
      "targets": [{
        "datasource": { "type": "prometheus", "uid": "${datasource}" },
        "expr": "count(rate(container_tasks_state{state=\"running\"}[5m]) > 3500 and on(pod) kube_pod_container_status_ready == 1) > 0",
        "instant": true,
        "refId": "A"
      }],
      "title": "Thread/PID Pressure",
      "type": "stat"
    }
  ],
  "refresh": "5m",
  "schemaVersion": 39,
  "tags": ["openshift", "performance", "tuning", "multi-cluster"],
  "templating": {
    "list": [
      {
        "current": {},
        "hide": 0,
        "includeAll": true,
        "label": "Cluster",
        "multi": true,
        "name": "datasource",
        "options": [],
        "query": "prometheus",
        "refresh": 1,
        "regex": "",
        "type": "datasource"
      }
    ]
  },
  "time": { "from": "now-1h", "to": "now" },
  "title": "OpenShift 4.16 Full Tuning Status (Multi-Cluster)",
  "uid": "ocp416-full-tuning",
  "version": 1
}





=====================================================
{
  "annotations": {
    "list": []
  },
  "editable": true,
  "gnetId": null,
  "graphTooltip": 0,
  "id": null,
  "links": [],
  "panels": [
    {
      "datasource": {
        "type": "prometheus",
        "uid": "${datasource}"
      },
      "fieldConfig": {
        "defaults": {
          "mappings": [
            {
              "options": {
                "0": {
                  "text": "OK"
                },
                "1": {
                  "text": "IMPACTED"
                }
              },
              "type": "value"
            }
          ],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": null
              },
              {
                "color": "red",
                "value": 1
              }
            ]
          }
        },
        "overrides": []
      },
      "gridPos": {
        "h": 6,
        "w": 4,
        "x": 0,
        "y": 0
      },
      "id": 1,
      "options": {
        "colorMode": "value",
        "graphMode": "none",
        "justifyMode": "center",
        "textMode": "auto"
      },
      "pluginVersion": "10.4.0",
      "targets": [
        {
          "datasource": {
            "type": "prometheus",
            "uid": "${datasource}"
          },
          "expr": "((container_memory_working_set_bytes{container=~\".*java.*|.*jvm.*\"} / container_spec_memory_limit_bytes{container=~\".*java.*|.*jvm.*\"}) > 0.9) or (rate(kube_pod_container_status_terminated_reason{reason=\"OOMKilled\"}[1h]) > 0 and on(pod) container_memory_working_set_bytes{container=~\".*java.*\"} > 0)",
          "instant": true,
          "refId": "A"
        }
      ],
      "title": "Java Memory Tuning",
      "type": "stat"
    },
    {
      "datasource": {
        "type": "prometheus",
        "uid": "${datasource}"
      },
      "fieldConfig": {
        "defaults": {
          "mappings": [
            {
              "options": {
                "0": {
                  "text": "OK"
                },
                "1": {
                  "text": "IMPACTED"
                }
              },
              "type": "value"
            }
          ],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": null
              },
              {
                "color": "red",
                "value": 1
              }
            ]
          }
        },
        "overrides": []
      },
      "gridPos": {
        "h": 6,
        "w": 4,
        "x": 4,
        "y": 0
      },
      "id": 2,
      "options": {
        "colorMode": "value",
        "graphMode": "none",
        "justifyMode": "center",
        "textMode": "auto"
      },
      "pluginVersion": "10.4.0",
      "targets": [
        {
          "datasource": {
            "type": "prometheus",
            "uid": "${datasource}"
          },
          "expr": "count(count by(node) (kube_pod_info) > 50) > 0",
          "instant": true,
          "refId": "A"
        }
      ],
      "title": "High-Density Nodes",
      "type": "stat"
    },
    {
      "datasource": {
        "type": "prometheus",
        "uid": "${datasource}"
      },
      "fieldConfig": {
        "defaults": {
          "mappings": [
            {
              "options": {
                "0": {
                  "text": "OK"
                },
                "1": {
                  "text": "IMPACTED"
                }
              },
              "type": "value"
            }
          ],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": null
              },
              {
                "color": "red",
                "value": 1
              }
            ]
          }
        },
        "overrides": []
      },
      "gridPos": {
        "h": 6,
        "w": 4,
        "x": 8,
        "y": 0
      },
      "id": 3,
      "options": {
        "colorMode": "value",
        "graphMode": "none",
        "justifyMode": "center",
        "textMode": "auto"
      },
      "pluginVersion": "10.4.0",
      "targets": [
        {
          "datasource": {
            "type": "prometheus",
            "uid": "${datasource}"
          },
          "expr": "(sum by(pod) (container_memory_working_set_bytes{pod=~\"etcd-.*|kube-apiserver-.*\"}) / sum by(pod) (container_spec_memory_limit_bytes{pod=~\"etcd-.*|kube-apiserver-.*\"})) >= 0.85",
          "instant": true,
          "refId": "A"
        }
      ],
      "title": "Control Plane Memory",
      "type": "stat"
    },
    {
      "datasource": {
        "type": "prometheus",
        "uid": "${datasource}"
      },
      "fieldConfig": {
        "defaults": {
          "mappings": [
            {
              "options": {
                "0": {
                  "text": "OK"
                },
                "1": {
                  "text": "IMPACTED"
                }
              },
              "type": "value"
            }
          ],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": null
              },
              {
                "color": "red",
                "value": 1
              }
            ]
          }
        },
        "overrides": []
      },
      "gridPos": {
        "h": 6,
        "w": 4,
        "x": 12,
        "y": 0
      },
      "id": 4,
      "options": {
        "colorMode": "value",
        "graphMode": "none",
        "justifyMode": "center",
        "textMode": "auto"
      },
      "pluginVersion": "10.4.0",
      "targets": [
        {
          "datasource": {
            "type": "prometheus",
            "uid": "${datasource}"
          },
          "expr": "histogram_quantile(0.99, rate(etcd_disk_backend_commit_duration_seconds_bucket[5m])) > 0.1",
          "instant": true,
          "refId": "A"
        }
      ],
      "title": "etcd Latency",
      "type": "stat"
    },
    {
      "datasource": {
        "type": "prometheus",
        "uid": "${datasource}"
      },
      "fieldConfig": {
        "defaults": {
          "mappings": [
            {
              "options": {
                "0": {
                  "text": "OK"
                },
                "1": {
                  "text": "IMPACTED"
                }
              },
              "type": "value"
            }
          ],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": null
              },
              {
                "color": "red",
                "value": 1
              }
            ]
          }
        },
        "overrides": []
      },
      "gridPos": {
        "h": 6,
        "w": 4,
        "x": 16,
        "y": 0
      },
      "id": 5,
      "options": {
        "colorMode": "value",
        "graphMode": "none",
        "justifyMode": "center",
        "textMode": "auto"
      },
      "pluginVersion": "10.4.0",
      "targets": [
        {
          "datasource": {
            "type": "prometheus",
            "uid": "${datasource}"
          },
          "expr": "(rate(container_cpu_cfs_throttled_periods_total[5m]) / rate(container_cpu_cfs_periods_total[5m])) > 0.25",
          "instant": true,
          "refId": "A"
        }
      ],
      "title": "CPU Throttling",
      "type": "stat"
    }
  ],
  "refresh": "5m",
  "schemaVersion": 39,
  "tags": [
    "openshift",
    "multi-cluster",
    "enterprise",
    "tuning"
  ],
  "templating": {
    "list": [
      {
        "current": {},
        "hide": 0,
        "includeAll": true,
        "label": "Datasource",
        "multi": true,
        "name": "datasource",
        "options": [],
        "query": "prometheus",
        "refresh": 1,
        "regex": "",
        "type": "datasource"
      }
    ]
  },
  "time": {
    "from": "now-1h",
    "to": "now"
  },
  "title": "OpenShift 4.16 Multi-Cluster Tuning Status (Enterprise)",
  "uid": "ocp416-enterprise-multi",
  "version": 1,
  "weekStart": ""
}
